# Load all stock functions (from $fpath files) called below.
autoload -U compaudit compinit

ZSH_COMPDUMP="/home/calvin/.cache/zsh/zcompdump-$(hostname)-${ZSH_VERSION}"
compinit -i -C -d "${ZSH_COMPDUMP}"

# Completion
zmodload -i zsh/complist

unsetopt menu_complete   # do not autoselect the first completion entry
unsetopt flowcontrol
setopt auto_menu         # show completion menu on successive tab press
setopt complete_in_word
setopt always_to_end

bindkey -M menuselect '^o' accept-and-infer-next-history
zstyle ':completion:*:*:*:*:*' menu select

# Case insensitive completion
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' 'r:|=*' 'l:|=* r:|=*'
# _ and - are interchangable
#zstyle ':completion:*' matcher-list 'm:{a-zA-Z-_}={A-Za-z_-}' 'r:|=*' 'l:|=* r:|=*'

# Complete . and .. special directories
#zstyle ':completion:*' special-dirs true

zstyle ':completion:*' list-colors ''

# History

# disable named-directories autocompletion
zstyle ':completion:*:cd:*' tag-order local-directories directory-stack path-directories

# automatically load bash completion functions
autoload -U +X bashcompinit && bashcompinit

# History #
HISTSIZE=10000
SAVEHIST=10000
HISTFILE=~/.cache/zsh/history
setopt EXTENDED_HISTORY          # Write the history file in the ":start:elapsed;command" format.
setopt HIST_EXPIRE_DUPS_FIRST    # Expire duplicate entries first when trimming history.
setopt HIST_IGNORE_DUPS          # Don't record an entry that was just recorded again.
setopt HIST_IGNORE_ALL_DUPS      # Delete old recorded entry if new entry is a duplicate.
setopt HIST_FIND_NO_DUPS         # Do not display a line previously found.
setopt HIST_IGNORE_SPACE         # Don't record an entry starting with a space.
setopt HIST_SAVE_NO_DUPS         # Don't write duplicate entries in the history file.

# Theme and appearance
# ls colors
autoload -U colors && colors

# correct ls colors in tab completion
if [[ -z "$LS_COLORS" ]]; then
    (( $+commands[dircolors] )) && eval "$(dircolors -b)"
fi

#ls --color -d . &>/dev/null && alias ls='ls --color=tty' || { ls -G . &>/dev/null && alias ls='ls -G' }

# Take advantage of $LS_COLORS for completion as well.
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"

setopt auto_cd
setopt multios
setopt prompt_subst

# vim keys
KEYTIMEOUT=1
bindkey -v

export EDITOR=nvim

unalias -m '*'

# ls aliases
alias ls='ls -vN --color=auto --group-directories-first'
alias la='ls -A'
alias l='exa --group-directories-first -l'
alias ll='l -a'
# If don't have exa
# alias ll='ls -AlhF'
# alias l='ls -lh'

# color aliases
alias grep='grep --color=auto'
alias diff='diff --color=auto'

# Program aliases
alias vim='nvim'
alias more='less'
alias df='df -h'
alias cat='bat --theme base16'
alias ytdl-audio="youtube-dl --config-location $XDG_CONFIG_HOME/youtube-dl/audio.conf"
alias ytdl-video="youtube-dl --config-location $XDG_CONFIG_HOME/youtube-dl/video.conf"

# XDG Compliance
alias wget='wget --hsts-file="$XDG_CACHE_HOME/wget-hsts"'

# Other aliases
alias ssh-termux='adb forward tcp:8022 tcp:8022 && ssh localhost -p 8022'
alias weather='curl wttr.in'


# fzf
source /usr/share/fzf/completion.zsh
source /usr/share/fzf/key-bindings.zsh

source /usr/share/zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

#eval "$(starship init zsh)"
source ~/git.zsh
PROMPT="%(?:%{$fg_bold[green]%}➜ :%{$fg_bold[red]%}➜ )"
PROMPT+='%{$fg[cyan]%}%c%{$reset_color%} $(git_prompt_info)'

ZSH_THEME_GIT_PROMPT_PREFIX="%{$fg_bold[blue]%}git:(%{$fg[red]%}"
ZSH_THEME_GIT_PROMPT_SUFFIX="%{$reset_color%} "
ZSH_THEME_GIT_PROMPT_DIRTY="%{$fg[blue]%}) %{$fg[yellow]%}✗"
ZSH_THEME_GIT_PROMPT_CLEAN="%{$fg[blue]%})"
